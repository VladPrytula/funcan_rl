[[Day_3_FINAL#]]

### Agenda:

##### üìò Day 4 ‚Äì Week 1: Carath√©odory Extension and the Construction of Lebesgue Measure
**Total time: ~90 minutes (Thursday extended proof session)**

Authorship: /dubois (Professor Jean‚ÄëPierre Dubois)

**‚ö†Ô∏è Content Density Notice**: This material is the most technically demanding of Week 1.
- **Target time**: 90 minutes (Syllabus ideal)
- **Realistic time**: 120-150 minutes for first-time study

**Two Study Paths**:
- **Core path** (~90 min): Sections I-II (hierarchy + outer measure), IV (Theorem 1.9 structure), VI (Lebesgue measure application)
- **Extended path** (~150 min): Full proofs of Steps 1-6 in Theorem 1.9 + RL connections (Section VII)

**Recommendation**: If approaching 2.5 hours, complete core path and mark extended proofs for review. Section VI (Lebesgue measure construction) and Section VII (RL applications) are essential; detailed verification of Carath√©odory criterion manipulations in Steps 3-5 can be revisited if needed.

---

#### **‚è±Ô∏è Segment 1 (30 min) ‚Äì Reading**

**Topic:** _Outer measure, Carath√©odory's criterion, and extension theorem_

- Read from Folland [@folland:real_analysis:1999, ¬ß1.4‚Äì¬ß1.5] or Durrett [@durrett:probability:2019, Ch. 1].
- Focus on:
    - Definition of outer measure and its properties
    - Carath√©odory's measurability criterion: when is a set $\mu^*$-measurable?
    - Statement of Carath√©odory extension theorem
    - Why semirings and algebras are natural starting points
- _Key takeaway:_ The Carath√©odory extension provides the rigorous construction of Lebesgue measure from the elementary concept of "length of an interval."

---

#### **‚è±Ô∏è Segment 2 (50 min) ‚Äì Extended Proof**

**Exercise:**
Prove the Carath√©odory extension theorem completely for the construction of Lebesgue measure on $\mathbb{R}^n$ from the algebra of finite unions of rectangles.

**Structure:**
1. Define outer measure $\mu^*$ from a pre-measure on a semiring
2. Prove Carath√©odory's criterion: the collection of $\mu^*$-measurable sets forms a $\sigma$-algebra
3. Show that $\mu^*$ restricted to this $\sigma$-algebra is a measure
4. Verify that the original algebra is contained in the measurable sets
5. Apply to construct Lebesgue measure on $\mathbb{R}^n$

---

#### **‚è±Ô∏è Segment 3 (10 min) ‚Äì Reflection**

**Conceptual bridge to RL:**
- The $\sigma$-algebra determines what's observable in an MDP
- Carath√©odory's construction shows how to extend finite-dimensional "measurements" to infinite $\sigma$-algebras
- In continuous state spaces, the Borel $\sigma$-algebra (generated by open sets) gives us the measurable structure
- Transition kernels $P(\cdot | s,a)$ are measures on this $\sigma$-algebra, constructed via Carath√©odory-type extensions

**Reflection question:**
How does the extension from an algebra to a $\sigma$-algebra relate to extending finite-horizon value functions to infinite-horizon?

---

üìÖ Tomorrow (Day 5): **Friday synthesis**: $\sigma$-algebras and observability in RL, coding implementation of discrete $\sigma$-algebra generators.

---

### **Chapter 1: Foundations in Measure and Probability Theory**

#### **1.5 The Carath√©odory Extension Theorem: From Rectangles to Rigor**

**Motivation:** We have developed the abstract theory of measure spaces, $\sigma$-algebras, and Lebesgue integration. But where do measures *come from*? How do we rigorously construct the Lebesgue measure $\lambda$ on $\mathbb{R}^n$‚Äîthe fundamental measure that assigns to an interval $(a,b)$ its length $b-a$, to a rectangle $\prod_{i=1}^n (a_i, b_i]$ its volume $\prod_{i=1}^n (b_i - a_i)$, and extends consistently to all Borel sets?

The intuitive notion of "length" or "volume" is easy to define on simple geometric objects‚Äîintervals, rectangles, finite unions thereof. But the Borel $\sigma$-algebra $\mathcal{B}(\mathbb{R}^n)$ contains vastly more complicated sets: countable unions and intersections of open sets, limits of sequences of sets, pathological constructions like the Cantor set. How can we extend our elementary notion of "volume" from rectangles to this vast collection, while preserving the essential property of countable additivity?

This is the problem solved definitively by **Constantin Carath√©odory** in 1914. His **extension theorem** (Theorem 1.10 below) provides a canonical procedure: begin with a simple collection of sets (an algebra or semiring) on which a measure-like function (a pre-measure) is defined, extend it first to an *outer measure* on all subsets, then identify a $\sigma$-algebra of "Carath√©odory-measurable sets" on which this outer measure restricts to a bona fide measure. The construction is both elegant and universal‚Äîit is the foundation not only of Lebesgue measure but of all modern measure theory.

For reinforcement learning, this construction is not merely historical context. When we work with continuous state spaces $\mathcal{S} \subseteq \mathbb{R}^n$, the transition kernel $P(\cdot | s,a)$ is a probability measure on $(\mathcal{S}, \mathcal{B}(\mathcal{S}))$. Understanding *how* this measure is constructed‚Äîhow it extends from elementary sets to the full Borel $\sigma$-algebra‚Äîis essential for understanding when our algorithms are well-defined. Moreover, the Carath√©odory construction teaches us how to extend "local" information (transition probabilities between nearby states) to "global" information (probabilities of reaching arbitrary measurable sets), a conceptual pattern that recurs throughout Markov process theory.

**Learning Objectives:**
* Understand the hierarchy: semiring $\to$ algebra $\to$ $\sigma$-algebra
* Define outer measure and prove its subadditivity
* Master Carath√©odory's criterion for measurability
* Prove that Carath√©odory-measurable sets form a $\sigma$-algebra on which $\mu^*$ is a measure (Theorem 1.9)
* Apply the Carath√©odory Extension Theorem (Theorem 1.10) to build Lebesgue measure on $\mathbb{R}^n$
* Recognize this as the prototype for constructing probability measures on continuous spaces

---

### **I. Core Theory: The Building Blocks**

Before stating the main theorem, we must establish the hierarchy of set structures that lead from elementary sets to $\sigma$-algebras.

#### **A. Semirings, Algebras, and $\sigma$-Algebras**

**Definition 1.13 (Semiring).** A collection $\mathcal{S} \subseteq 2^X$ is a **semiring** if:
1. $\emptyset \in \mathcal{S}$
2. If $A, B \in \mathcal{S}$, then $A \cap B \in \mathcal{S}$ (closed under finite intersections)
3. If $A, B \in \mathcal{S}$ with $A \subseteq B$, then there exist finitely many pairwise disjoint sets $C_1, \ldots, C_n \in \mathcal{S}$ such that:
   $$
   B \setminus A = \bigcup_{i=1}^{n} C_i
   $$

**Example 1.4 (Semiring of Half-Open Rectangles).** In $\mathbb{R}^n$, define the collection of half-open rectangles:
$$
\mathcal{R}_n = \left\{ \prod_{i=1}^{n} (a_i, b_i] \;\Big|\; a_i < b_i, \, a_i, b_i \in \mathbb{R} \right\} \cup \{\emptyset\}
$$
This is a semiring. For $R_1, R_2 \in \mathcal{R}_n$, the intersection $R_1 \cap R_2$ is also a rectangle (possibly empty). The set difference $R_2 \setminus R_1$ can be expressed as a finite union of disjoint rectangles (see Exercise 1 in the companion file for detailed verification). This semiring is the natural starting point for constructing Lebesgue measure.

**Definition 1.14 (Algebra of Sets).** A collection $\mathcal{A} \subseteq 2^X$ is an **algebra** if:
1. $X \in \mathcal{A}$
2. If $A \in \mathcal{A}$, then $A^c \in \mathcal{A}$ (closed under complementation)
3. If $A, B \in \mathcal{A}$, then $A \cup B \in \mathcal{A}$ (closed under *finite* unions)

**Remark 1.14.** An algebra is "almost" a $\sigma$-algebra‚Äîthe only difference is that it is closed under finite unions rather than countable unions. Every $\sigma$-algebra is an algebra, but not conversely.

**Remark 1.14a (Why This Hierarchy?).** The progression semiring $\to$ algebra $\to$ $\sigma$-algebra reflects increasing closure properties. Semirings are minimal structures for defining "volume" (intersections and differences suffice). Algebras add complements and finite unions, enabling finite Boolean operations. $\sigma$-Algebras add countable unions, essential for taking limits‚Äîthe foundation of Lebesgue integration and probability theory. Each level is strictly more general than the last: $\mathcal{S} \subseteq \mathcal{A}(\mathcal{S}) \subseteq \sigma(\mathcal{A}(\mathcal{S}))$.

**Example 1.5 (Algebra Generated by a Semiring).** Given a semiring $\mathcal{S}$ on $X$, we can construct an algebra $\mathcal{A}(\mathcal{S})$ containing $\mathcal{S}$. For the semiring $\mathcal{R}_n$ of rectangles, the algebra $\mathcal{A}(\mathcal{R}_n)$ consists of all finite Boolean combinations (unions, intersections, differences) of rectangles‚Äîprecisely the "elementary sets" on which we can easily define volume. The complete characterization is technical (see [@folland:real_analysis:1999, ¬ß1.3, Thm. 1.6]), but for Carath√©odory's application, we need only know that such an algebra exists and contains all finite disjoint unions of rectangles.

**Table 1.1: Comparative Summary of Set Structures**

| Property | Semiring $\mathcal{S}$ | Algebra $\mathcal{A}$ | $\sigma$-Algebra $\mathcal{F}$ |
|----------|------------------------|----------------------|------------------------|
| **Contains $\emptyset$** | ‚úì | ‚úì | ‚úì |
| **Contains $X$** | ‚úó (generally) | ‚úì | ‚úì |
| **Closed under complement** | ‚úó | ‚úì | ‚úì |
| **Closed under finite intersection** | ‚úì | ‚úì | ‚úì |
| **Closed under finite union** | ‚úó (but differences are finite unions) | ‚úì | ‚úì |
| **Closed under countable union** | ‚úó | ‚úó | ‚úì |
| **Example in $\mathbb{R}^n$** | Half-open rectangles $\mathcal{R}_n$ | Finite Boolean combinations $\mathcal{A}(\mathcal{R}_n)$ | Borel $\sigma$-algebra $\mathcal{B}(\mathbb{R}^n)$ |
| **Typical use** | Starting point for pre-measures | Intermediate step for Carath√©odory | Final domain for measures |
| **RL Interpretation** | Elementary state transitions (single-step kernels) | Finite-horizon reachable sets | All measurable events/observables |

---

#### **B. Pre-Measures and Their Extension**

**Definition 1.15 (Pre-Measure).** {#DEF-1.4.1} (cf. [@folland:real_analysis:1999, ¬ß1.4‚Äì¬ß1.5])
Let $\mathcal{A}$ be an algebra on $X$. A function $\mu_0: \mathcal{A} \to [0, \infty]$ is a **pre-measure** if:
1. $\mu_0(\emptyset) = 0$
2. **(Countable additivity on $\mathcal{A}$)** For any countable collection $\{A_n\}_{n=1}^{\infty}$ of pairwise disjoint sets in $\mathcal{A}$ such that $\bigcup_{n=1}^{\infty} A_n \in \mathcal{A}$, we have:
   $$
   \mu_0\left(\bigcup_{n=1}^{\infty} A_n\right) = \sum_{n=1}^{\infty} \mu_0(A_n)
   $$

**Remark 1.15.** The key subtlety: $\mathcal{A}$ is only an algebra, not a $\sigma$-algebra, so countable unions of sets in $\mathcal{A}$ may *not* be in $\mathcal{A}$. The condition requires countable additivity only when the union happens to be in $\mathcal{A}$. This is weaker than being a measure.

**Remark 1.15a (Why Pre-Measures Matter).** Most countable unions $\bigcup_{n=1}^{\infty} A_n$ with $A_n \in \mathcal{A}$ will *not* be in $\mathcal{A}$ (algebras are not closed under countable unions). The pre-measure property only requires additivity in the rare cases when such a union happens to land in $\mathcal{A}$. This is precisely what allows us to extend from $\mathcal{A}$ to $\sigma(\mathcal{A})$ via the Carath√©odory construction.

**Example 1.6 (Pre-Measure of Volume on Rectangles).** On the algebra $\mathcal{A}(\mathcal{R}_n)$ of finite Boolean combinations of rectangles in $\mathbb{R}^n$, define:
$$
\mu_0\left(\prod_{i=1}^{n} (a_i, b_i]\right) = \prod_{i=1}^{n} (b_i - a_i)
$$
and extend to $\mathcal{A}(\mathcal{R}_n)$ by finite additivity on disjoint unions. This is a pre-measure (verification in Exercise 3 of the companion file). Our goal is to extend this to a measure on all Borel sets.

---

### **II. The Carath√©odory Construction: Outer Measure**

The first step is to extend the pre-measure from the algebra $\mathcal{A}$ to an "outer measure" defined on *all* subsets of $X$, at the cost of losing additivity.

**Definition 1.16 (Outer Measure).** {#DEF-1.4.2} (cf. [@folland:real_analysis:1999, ¬ß1.4])
Let $\mathcal{A}$ be an algebra on $X$ with pre-measure $\mu_0$. For any $E \subseteq X$, define the **outer measure**:
$$
\mu^*(E) = \inf \left\{ \sum_{n=1}^{\infty} \mu_0(A_n) \;\Big|\; A_n \in \mathcal{A}, \, E \subseteq \bigcup_{n=1}^{\infty} A_n \right\}
$$
That is, $\mu^*(E)$ is the infimum of the total $\mu_0$-measure of all countable covers of $E$ by sets from $\mathcal{A}$.

**Remark 1.16 (Intuition).** We "measure" an arbitrary set $E$ by covering it with simple sets from $\mathcal{A}$, adding up their measures, and taking the infimum over all such covers. This is the outer "envelope" of $E$ when approximated from the outside.

**Proposition 1.8 (Properties of Outer Measure).** {#PROP-1.4.1} (cf. [@folland:real_analysis:1999, ¬ß1.4])
The outer measure $\mu^*$ satisfies:
1. **Non-negativity:** $\mu^*(E) \geq 0$ for all $E \subseteq X$
2. **Null empty set:** $\mu^*(\emptyset) = 0$
3. **Monotonicity:** If $E_1 \subseteq E_2$, then $\mu^*(E_1) \leq \mu^*(E_2)$
4. **Countable subadditivity:** For any countable collection $\{E_n\}$:
   $$
   \mu^*\left(\bigcup_{n=1}^{\infty} E_n\right) \leq \sum_{n=1}^{\infty} \mu^*(E_n)
   $$

*Proof.*

**(1) and (2):** Non-negativity is immediate. For $\emptyset$, note that $\emptyset \in \mathcal{A}$ (as $\mathcal{A}$ is an algebra), $\emptyset \subseteq \emptyset$, and $\mu_0(\emptyset) = 0$, so $\mu^*(\emptyset) \leq \mu_0(\emptyset) = 0$. By non-negativity, $\mu^*(\emptyset) \ge 0$, hence $\mu^*(\emptyset) = 0$.

**(3) Monotonicity:** If $E_1 \subseteq E_2$ and $\{A_n\}$ is a cover of $E_2$, then it also covers $E_1$. Thus the infimum over covers of $E_1$ is at most the infimum over covers of $E_2$.

**(4) Countable subadditivity:** This is the critical property. We must show:
$$
\mu^*\left(\bigcup_{n=1}^{\infty} E_n\right) \leq \sum_{n=1}^{\infty} \mu^*(E_n)
$$

If $\sum_{n=1}^{\infty} \mu^*(E_n) = \infty$, the inequality is trivial. Assume $\sum_{n=1}^{\infty} \mu^*(E_n) < \infty$.

Fix $\varepsilon > 0$. For each $n$, by the definition of infimum, there exists a cover $\{A_{n,k}\}_{k=1}^{\infty} \subseteq \mathcal{A}$ with $E_n \subseteq \bigcup_{k=1}^{\infty} A_{n,k}$ such that:
$$
\sum_{k=1}^{\infty} \mu_0(A_{n,k}) \leq \mu^*(E_n) + \frac{\varepsilon}{2^n}
$$

The collection $\{A_{n,k}\}_{n,k=1}^{\infty}$ is a countable cover of $\bigcup_{n=1}^{\infty} E_n$. Therefore:
$$
\mu^*\left(\bigcup_{n=1}^{\infty} E_n\right) \leq \sum_{n=1}^{\infty} \sum_{k=1}^{\infty} \mu_0(A_{n,k}) \leq \sum_{n=1}^{\infty} \left(\mu^*(E_n) + \frac{\varepsilon}{2^n}\right) = \sum_{n=1}^{\infty} \mu^*(E_n) + \varepsilon
$$

Since $\varepsilon > 0$ was arbitrary, we conclude:
$$
\mu^*\left(\bigcup_{n=1}^{\infty} E_n\right) \leq \sum_{n=1}^{\infty} \mu^*(E_n)
$$
as claimed. ‚ñ°

**Remark 1.17 (The Gap: From Subadditivity to Additivity).** Note that $\mu^*$ satisfies *countable subadditivity* but not necessarily *countable additivity*. It is an outer measure, not yet a measure. The inequality may be strict. Carath√©odory's genius was to identify precisely which sets $E$ satisfy the stronger property of additivity‚Äîthese will be the "Carath√©odory-measurable sets."

---

### **III. Carath√©odory's Criterion: The Measurable Sets**

We now define the notion of measurability with respect to an outer measure‚Äîa definition that initially appears mysterious but reveals its necessity through the theorem that follows.

**Definition 1.17 (Carath√©odory-Measurable Set).** {#DEF-1.4.3} (cf. [@folland:real_analysis:1999, ¬ß1.4])
Let $\mu^*$ be an outer measure on $X$. A set $E \subseteq X$ is **$\mu^*$-measurable** (or **Carath√©odory-measurable**) if for every set $A \subseteq X$:
$$
\mu^*(A) = \mu^*(A \cap E) + \mu^*(A \cap E^c) \tag{1.8}
$$

**Remark 1.18 (Interpreting the Criterion).** This condition states that $E$ "splits" every test set $A$ in an additive way. By subadditivity, we always have $\mu^*(A) \leq \mu^*(A \cap E) + \mu^*(A \cap E^c)$. The content of measurability is the reverse inequality:
$$
\mu^*(A) \geq \mu^*(A \cap E) + \mu^*(A \cap E^c)
$$
This says: approximating $A$ by covering $A \cap E$ and $A \cap E^c$ separately is no worse than covering $A$ directly. In other words, $E$ and $E^c$ do not "interfere" with each other when measuring.

**Remark 1.19 (Justification of the Definition).** This definition, though initially opaque, is precisely calibrated to ensure the following theorem. Its justification is the power of the result it enables: the collection of $\mu^*$-measurable sets is a $\sigma$-algebra on which $\mu^*$ restricts to a measure.

---

### **IV. The Main Theorem: Carath√©odory-Measurable Sets Form a $\sigma$-Algebra**

We now arrive at the heart of the construction.

**Theorem 1.9 (Carath√©odory's Theorem ‚Äì Part I).** {#THM-1.4.1} (cf. [@folland:real_analysis:1999, ¬ß1.4])
Let $\mu^*$ be an outer measure on $X$, and let $\mathcal{M}$ denote the collection of all $\mu^*$-measurable sets. Then:
1. $\mathcal{M}$ is a $\sigma$-algebra on $X$
2. The restriction of $\mu^*$ to $\mathcal{M}$, denoted $\mu = \mu^*|_{\mathcal{M}}$, is a measure

*Proof.* This is a long proof with several steps. We proceed systematically.

#### **Step 1: $\emptyset$ and $X$ are in $\mathcal{M}$**

For any $A \subseteq X$:
$$
\mu^*(A) = \mu^*(A \cap \emptyset) + \mu^*(A \cap \emptyset^c) = \mu^*(\emptyset) + \mu^*(A) = 0 + \mu^*(A)
$$
Thus $\emptyset \in \mathcal{M}$. Since $X^c = \emptyset$, by the same argument $X \in \mathcal{M}$.

#### **Step 2: $\mathcal{M}$ is closed under complementation**

Suppose $E \in \mathcal{M}$. For any test set $A$:
$$
\mu^*(A) = \mu^*(A \cap E) + \mu^*(A \cap E^c)
$$
By symmetry, swapping $E$ and $E^c$:
$$
\mu^*(A) = \mu^*(A \cap E^c) + \mu^*(A \cap (E^c)^c) = \mu^*(A \cap E^c) + \mu^*(A \cap E)
$$
Thus $E^c \in \mathcal{M}$.

#### **Step 3: $\mathcal{M}$ is closed under finite unions**

Let $E_1, E_2 \in \mathcal{M}$. We must show $E_1 \cup E_2 \in \mathcal{M}$, i.e., for any $A \subseteq X$:
$$
\mu^*(A) \geq \mu^*(A \cap (E_1 \cup E_2)) + \mu^*(A \cap (E_1 \cup E_2)^c) \tag{*}
$$
(The "$\leq$" direction follows from subadditivity.)

**Applying measurability of $E_1$ to the test set $A$:**
$$
\mu^*(A) = \mu^*(A \cap E_1) + \mu^*(A \cap E_1^c)
$$

**Applying measurability of $E_2$ to the test set $A \cap E_1^c$:**
$$
\mu^*(A \cap E_1^c) = \mu^*((A \cap E_1^c) \cap E_2) + \mu^*((A \cap E_1^c) \cap E_2^c)
$$
Simplifying:
$$
\mu^*(A \cap E_1^c) = \mu^*(A \cap E_1^c \cap E_2) + \mu^*(A \cap E_1^c \cap E_2^c)
$$

Substituting back into the first equation:
$$
\mu^*(A) = \mu^*(A \cap E_1) + \mu^*(A \cap E_1^c \cap E_2) + \mu^*(A \cap E_1^c \cap E_2^c)
$$

Now observe the key set decomposition:
$$
A \cap (E_1 \cup E_2) = (A \cap E_1) \sqcup (A \cap E_1^c \cap E_2)
$$
where $\sqcup$ denotes disjoint union (the sets $A \cap E_1$ and $A \cap E_1^c \cap E_2$ are disjoint).

Also:
$$
A \cap (E_1 \cup E_2)^c = A \cap E_1^c \cap E_2^c
$$

By **monotonicity** of outer measure ([PROP-1.4.1]), since $A \cap E_1 \subseteq A \cap (E_1 \cup E_2)$ and $A \cap E_1^c \cap E_2 \subseteq A \cap (E_1 \cup E_2)$, we have:
$$
\mu^*(A \cap E_1) \leq \mu^*(A \cap (E_1 \cup E_2))
$$
$$
\mu^*(A \cap E_1^c \cap E_2) \leq \mu^*(A \cap (E_1 \cup E_2))
$$

However, for the disjoint union, we use **countable subadditivity** ([PROP-1.4.1]):
$$
\mu^*(A \cap (E_1 \cup E_2)) = \mu^*((A \cap E_1) \sqcup (A \cap E_1^c \cap E_2)) \leq \mu^*(A \cap E_1) + \mu^*(A \cap E_1^c \cap E_2)
$$

Combining with the equality from above:
$$
\mu^*(A) = \mu^*(A \cap E_1) + \mu^*(A \cap E_1^c \cap E_2) + \mu^*(A \cap E_1^c \cap E_2^c)
$$
$$
\geq \mu^*(A \cap (E_1 \cup E_2)) + \mu^*(A \cap (E_1 \cup E_2)^c)
$$

This establishes (*), so $E_1 \cup E_2 \in \mathcal{M}$.

By induction, $\mathcal{M}$ is closed under finite unions.

**Remark 1.20a (Why This Argument Works).** The proof uses only the properties of outer measure (monotonicity and subadditivity) combined with the measurability of $E_1$ and $E_2$. We never assume that $E_1 \cup E_2$ is measurable‚Äîthat is what we are proving. The set decomposition reduces the union to disjoint pieces, allowing us to apply subadditivity in the favorable direction.

#### **Step 4: Finite additivity on $\mathcal{M}$**

Before proving closure under countable unions, we establish finite additivity. Let $E_1, E_2 \in \mathcal{M}$ be disjoint. Applying Carath√©odory's criterion to $E_1$ with test set $A = E_1 \cup E_2$:
$$
\mu^*(E_1 \cup E_2) = \mu^*((E_1 \cup E_2) \cap E_1) + \mu^*((E_1 \cup E_2) \cap E_1^c)
$$
Since $E_1 \cap E_2 = \emptyset$:
$$
(E_1 \cup E_2) \cap E_1 = E_1, \quad (E_1 \cup E_2) \cap E_1^c = E_2
$$
Thus:
$$
\mu^*(E_1 \cup E_2) = \mu^*(E_1) + \mu^*(E_2)
$$
This extends by induction to finite disjoint unions.

#### **Step 5: $\mathcal{M}$ is closed under countable unions**

Let $\{E_n\}_{n=1}^{\infty}$ be a sequence of pairwise disjoint sets in $\mathcal{M}$. Define $E = \bigcup_{n=1}^{\infty} E_n$. We must show $E \in \mathcal{M}$.

For any test set $A$, define $F_N = \bigcup_{n=1}^{N} E_n$. Since $\mathcal{M}$ is closed under finite unions, $F_N \in \mathcal{M}$. Applying Carath√©odory's criterion:
$$
\mu^*(A) = \mu^*(A \cap F_N) + \mu^*(A \cap F_N^c)
$$

By finite additivity (Step 4), since $E_1, \ldots, E_N$ are disjoint:
$$
\mu^*(A \cap F_N) = \sum_{n=1}^{N} \mu^*(A \cap E_n)
$$

Also, $F_N^c \supseteq E^c$ (since $F_N \subseteq E$), so by monotonicity:
$$
\mu^*(A \cap F_N^c) \geq \mu^*(A \cap E^c)
$$

Thus:
$$
\mu^*(A) \geq \sum_{n=1}^{N} \mu^*(A \cap E_n) + \mu^*(A \cap E^c)
$$

Taking $N \to \infty$:
$$
\mu^*(A) \geq \sum_{n=1}^{\infty} \mu^*(A \cap E_n) + \mu^*(A \cap E^c)
$$

By countable subadditivity ([PROP-1.4.1]) applied to the cover $\{A \cap E_n\}$ of $A \cap E = \bigcup_{n=1}^{\infty} (A \cap E_n)$, we have:
$$
\mu^*(A \cap E) \leq \sum_{n=1}^{\infty} \mu^*(A \cap E_n)
$$

Combining with the inequality above:
$$
\mu^*(A) \geq \mu^*(A \cap E) + \mu^*(A \cap E^c)
$$

The reverse inequality follows from subadditivity. Therefore $E \in \mathcal{M}$.

**For non-disjoint unions:** If $\{E_n\}$ are not necessarily disjoint, define $F_1 = E_1$ and $F_n = E_n \setminus \bigcup_{k=1}^{n-1} E_k$ for $n \geq 2$. Then $\{F_n\}$ are disjoint, each $F_n \in \mathcal{M}$ (by closure under complements and finite unions), and $\bigcup F_n = \bigcup E_n$. By the disjoint case, $\bigcup E_n \in \mathcal{M}$.

Thus $\mathcal{M}$ is a $\sigma$-algebra.

#### **Step 6: $\mu^*$ restricts to a measure on $\mathcal{M}$**

We have shown:
- Finite additivity on $\mathcal{M}$ (Step 4)
- For disjoint $\{E_n\} \subseteq \mathcal{M}$, taking $A = \bigcup E_n$ in the argument of Step 5 gives:
  $$
  \mu^*\left(\bigcup_{n=1}^{\infty} E_n\right) = \sum_{n=1}^{\infty} \mu^*(E_n)
  $$

Thus $\mu = \mu^*|_{\mathcal{M}}$ is a measure. ‚ñ°

**Remark 1.20 (The Power of the Criterion).** Carath√©odory's measurability criterion (1.8) is precisely calibrated to ensure that the collection of measurable sets forms a $\sigma$-algebra. The proof required careful manipulation of set identities and applications of subadditivity. This is the technical heart of measure theory.

---

### **V. The Extension Theorem: From Algebra to $\sigma$-Algebra**

We now complete the construction by showing that the original algebra $\mathcal{A}$ is contained in the Carath√©odory $\sigma$-algebra, and that the extended measure agrees with the pre-measure on $\mathcal{A}$.

**Theorem 1.10 (Carath√©odory Extension Theorem).** {#THM-1.4.2} (cf. [@folland:real_analysis:1999, ¬ß1.5])
Let $\mathcal{A}$ be an algebra on $X$ with pre-measure $\mu_0$. Let $\mu^*$ be the outer measure constructed from $\mu_0$. Let $\mathcal{M}$ be the $\sigma$-algebra of $\mu^*$-measurable sets, and $\mu = \mu^*|_{\mathcal{M}}$ the restriction of $\mu^*$ to $\mathcal{M}$. Then:
1. $\mathcal{A} \subseteq \mathcal{M}$
2. $\mu(A) = \mu_0(A)$ for all $A \in \mathcal{A}$
3. $\sigma(\mathcal{A}) \subseteq \mathcal{M}$ (the $\sigma$-algebra generated by $\mathcal{A}$ is contained in $\mathcal{M}$)

*Proof.*

**(1) and (2): Every set in $\mathcal{A}$ is $\mu^*$-measurable.**

Let $A \in \mathcal{A}$. We must show that for any test set $T \subseteq X$:
$$
\mu^*(T) = \mu^*(T \cap A) + \mu^*(T \cap A^c)
$$

By subadditivity, we always have $\mu^*(T) \leq \mu^*(T \cap A) + \mu^*(T \cap A^c)$. We must prove the reverse.

Fix $\varepsilon > 0$. By the definition of outer measure, there exists a cover $\{A_n\}_{n=1}^{\infty} \subseteq \mathcal{A}$ with $T \subseteq \bigcup A_n$ such that:
$$
\sum_{n=1}^{\infty} \mu_0(A_n) \leq \mu^*(T) + \varepsilon
$$

For each $n$, the set $A_n \in \mathcal{A}$, and since $\mathcal{A}$ is an algebra, $A_n \cap A \in \mathcal{A}$ and $A_n \cap A^c \in \mathcal{A}$. These sets are disjoint and their union is $A_n$. By additivity of $\mu_0$ on disjoint sets in $\mathcal{A}$:
$$
\mu_0(A_n) = \mu_0(A_n \cap A) + \mu_0(A_n \cap A^c)
$$

Now observe:
- $T \cap A \subseteq \bigcup_{n=1}^{\infty} (A_n \cap A)$
- $T \cap A^c \subseteq \bigcup_{n=1}^{\infty} (A_n \cap A^c)$

By definition of outer measure:
$$
\mu^*(T \cap A) \leq \sum_{n=1}^{\infty} \mu_0(A_n \cap A)
$$
$$
\mu^*(T \cap A^c) \leq \sum_{n=1}^{\infty} \mu_0(A_n \cap A^c)
$$

Adding these:
$$
\mu^*(T \cap A) + \mu^*(T \cap A^c) \leq \sum_{n=1}^{\infty} (\mu_0(A_n \cap A) + \mu_0(A_n \cap A^c)) = \sum_{n=1}^{\infty} \mu_0(A_n) \leq \mu^*(T) + \varepsilon
$$

Since $\varepsilon > 0$ was arbitrary:
$$
\mu^*(T \cap A) + \mu^*(T \cap A^c) \leq \mu^*(T)
$$

Combined with the subadditivity inequality, we have equality. Thus $A \in \mathcal{M}$.

**To show $\mu(A) = \mu_0(A)$:** For $A \in \mathcal{A}$, the set $A$ itself is a cover of $A$ (with $A_1 = A$ and $A_n = \emptyset$ for $n \geq 2$). Thus:
$$
\mu^*(A) \leq \mu_0(A)
$$

For the reverse inequality, let $\{A_n\}$ be any cover of $A$ by sets in $\mathcal{A}$. Define a disjoint refinement inside $A$ by
$$
B_1 = A \cap A_1, \qquad B_n = A \cap \Bigl(A_n \setminus \bigcup_{k=1}^{n-1} A_k\Bigr) \quad (n \ge 2).
$$
Then $B_n \in \mathcal{A}$ (algebra closure under intersection and difference), the sets $\{B_n\}$ are pairwise disjoint, and $\bigcup_{n=1}^{\infty} B_n = A$. Since $\mu_0$ is a pre-measure, it is countably additive on such disjoint families whose union lies in $\mathcal{A}$; hence
$$
\mu_0(A) = \sum_{n=1}^{\infty} \mu_0(B_n) \le \sum_{n=1}^{\infty} \mu_0(A \cap A_n) \le \sum_{n=1}^{\infty} \mu_0(A_n).
$$

Taking the infimum over all covers:
$$
\mu_0(A) \leq \mu^*(A)
$$

Thus $\mu^*(A) = \mu_0(A)$.

**(3):** Since $\mathcal{A} \subseteq \mathcal{M}$ and $\mathcal{M}$ is a $\sigma$-algebra, the smallest $\sigma$-algebra containing $\mathcal{A}$ must be contained in $\mathcal{M}$:
$$
\sigma(\mathcal{A}) \subseteq \mathcal{M}
$$

‚ñ°

**Remark 1.21 (Uniqueness).** The measure $\mu$ on $\sigma(\mathcal{A})$ is uniquely determined by $\mu_0$ on $\mathcal{A}$, provided $\mu_0$ is $\sigma$-finite on $\mathcal{A}$. This is a consequence of the uniqueness of extension theorem (see [@folland:real_analysis:1999, ¬ß1.5, Thm. 1.14]). For Lebesgue measure, this uniqueness is automatic.

---

### **VI. Application: Construction of Lebesgue Measure on $\mathbb{R}^n$**

We now apply the Carath√©odory extension theorem to construct Lebesgue measure.

**Construction:**

1. **Step 1: Define the semiring of rectangles.**
   $$
   \mathcal{R}_n = \left\{ \prod_{i=1}^{n} (a_i, b_i] \;\Big|\; a_i < b_i \right\} \cup \{\emptyset\}
   $$

2. **Step 2: Define the pre-measure of volume.**
   For $R = \prod_{i=1}^{n} (a_i, b_i]$, define:
   $$
   \mu_0(R) = \prod_{i=1}^{n} (b_i - a_i)
   $$
   This is the elementary notion of "volume." Extend to the algebra $\mathcal{A}(\mathcal{R}_n)$ of finite Boolean combinations of rectangles by additivity.

3. **Step 3: Construct the outer measure.**
   For any $E \subseteq \mathbb{R}^n$:
   $$
   \lambda^*(E) = \inf \left\{ \sum_{k=1}^{\infty} \mu_0(R_k) \;\Big|\; R_k \in \mathcal{R}_n, \, E \subseteq \bigcup_{k=1}^{\infty} R_k \right\}
   $$

4. **Step 4: Apply Carath√©odory's theorem.**
   The collection $\mathcal{M}$ of $\lambda^*$-measurable sets is a $\sigma$-algebra, and $\lambda = \lambda^*|_{\mathcal{M}}$ is a measure.

5. **Step 5: Identify the Borel $\sigma$-algebra.**
   Since open sets in $\mathbb{R}^n$ can be written as countable unions of open rectangles with rational endpoints (yielding a countable base)‚Äîand each such open rectangle is a countable union of half-open rectangles‚Äîand since $\mathcal{A}(\mathcal{R}_n)$ generates these, we have:
   $$
   \mathcal{B}(\mathbb{R}^n) = \sigma(\text{open sets}) \subseteq \sigma(\mathcal{A}(\mathcal{R}_n)) \subseteq \mathcal{M}
   $$
   Thus Lebesgue measure is defined on all Borel sets.

**Theorem 1.11 (Lebesgue Measure on $\mathbb{R}^n$).** {#THM-1.4.3} (cf. [@folland:real_analysis:1999, ¬ß1.5])
There exists a unique measure $\lambda$ on $(\mathbb{R}^n, \mathcal{B}(\mathbb{R}^n))$ such that for any rectangle $R = \prod_{i=1}^{n} (a_i, b_i]$:
$$
\lambda(R) = \prod_{i=1}^{n} (b_i - a_i)
$$
This measure is called **Lebesgue measure**. It extends the elementary notion of volume to all Borel sets, and satisfies:
- Translation invariance: $\lambda(E + x) = \lambda(E)$ for any Borel set $E$ and $x \in \mathbb{R}^n$
- Outer regularity: $\lambda(E) = \inf \{\lambda(U) : E \subseteq U \text{ open}\}$
- Inner regularity (on finite-measure sets): if $\lambda(E) < \infty$, then $\lambda(E) = \sup\{\lambda(K) : K \subseteq E,\ K \text{ compact}\}$
- Completeness: every subset of a $\lambda$-null set is $\lambda$-measurable and has measure zero

**Remark 1.22 (The Lebesgue $\sigma$-Algebra is Larger).** The Borel $\sigma$-algebra $\mathcal{B}(\mathbb{R}^n)$ is strictly contained in $\mathcal{M}$, the $\sigma$-algebra of Lebesgue-measurable sets. As shown in Day 1 (Proposition 1.3), there exist subsets of measure-zero Borel sets that are not Borel-measurable but are Lebesgue-measurable. The Lebesgue $\sigma$-algebra is the completion of the Borel $\sigma$-algebra with respect to $\lambda$.

---

### **VII. Application Bridge: Carath√©odory Extension in Reinforcement Learning**

**Connection 1: Transition Kernels as Measures**

In a continuous-state MDP, the transition kernel $P(\cdot | s, a): \mathcal{B}(\mathcal{S}) \to [0,1]$ must be a probability measure for each fixed $(s,a)$. How is this measure constructed in practice?

Often, the dynamics are specified via a stochastic differential equation or a density function:
$$
S_{t+1} = f(S_t, a_t) + \varepsilon_t, \quad \varepsilon_t \sim \mathcal{N}(0, \Sigma)
$$

The kernel $P(\cdot | s,a)$ is the pushforward of the Gaussian measure $\mathcal{N}(0, \Sigma)$ under the measurable map $\varepsilon \mapsto f(s,a) + \varepsilon$. Since Gaussian measure is a (Borel) probability on $\mathbb{R}^n$ and $f$ is measurable, the pushforward is directly a probability measure on $\mathcal{B}(\mathcal{S})$. Carath√©odory‚Äôs construction underlies the prior existence of Lebesgue (hence Gaussian) measure; the pushforward step itself relies on measurability.

**Connection 2: Observability and $\sigma$-Algebras**

The state space $\mathcal{S}$ is equipped with the Borel $\sigma$-algebra $\mathcal{B}(\mathcal{S})$, which is generated by open sets. This $\sigma$-algebra determines what is "observable" by the agent. A deterministic policy $\pi: \mathcal{S} \to \mathcal{A}$ must be measurable with respect to $\mathcal{B}(\mathcal{S})$, meaning the decision can only depend on Borel-measurable information about the state. For stochastic policies $\pi: \mathcal{S} \times \mathcal{B}(\mathcal{A}) \to [0,1]$, the map $s \mapsto \pi(B | s)$ must be Borel-measurable for each fixed Borel set $B \subseteq \mathcal{A}$.

The Carath√©odory construction teaches us that $\mathcal{B}(\mathcal{S})$ is the "smallest" $\sigma$-algebra containing all open sets‚Äîprecisely the sets we can "observe" via finite-precision measurements. A policy that depends on a non-Borel-measurable function of the state (e.g., membership in a Vitali set, as discussed in Day 1) is physically unrealizable: in practice, state observations are finite-precision measurements (e.g., sensor readings quantized to 32-bit floats), which can only distinguish between Borel sets. A policy depending on non-Borel structure cannot be approximated by any finite-precision decision rule.

**Connection 3: Function Approximation and Measurability**

In deep RL, value functions are approximated by neural networks $V_\theta: \mathcal{S} \to \mathbb{R}$. For the Bellman equation to make sense, we need:
$$
\mathbb{E}_{s' \sim P(\cdot | s,a)}[V_\theta(s')]
$$
to be well-defined. This requires $V_\theta$ to be measurable. Neural networks, being compositions of continuous functions (linear maps + activations), are Borel-measurable by Proposition 1.4 (Day 1). The Carath√©odory construction guarantees that expectations with respect to $P(\cdot | s,a)$ are well-defined for all Borel-measurable functions.

---

**Key Takeaway for RL:**

The Carath√©odory extension is not an abstract curiosity‚Äîit is the rigorous foundation ensuring that:
- Transition kernels on continuous state spaces are well-defined probability measures
- Policies and value functions are measurable, making expectations computable
- The Bellman operator is a well-defined mapping on function spaces

Without this construction, the entire formalism of continuous-state MDPs would collapse.

---

### **VIII. Reflection and Forward Connections**

**Mathematical Insight:**

The Carath√©odory extension theorem is a monument to the power of abstraction. It shows that to construct a measure on a complicated $\sigma$-algebra, we need only:
1. Define a "pre-measure" on a simple algebra (or semiring)
2. Extend to an outer measure by taking infima over covers
3. Identify the measurable sets via Carath√©odory's criterion
4. Restrict the outer measure to obtain a true measure

This pattern recurs throughout mathematics: start with elementary objects, extend via a limiting process, then characterize which extended objects retain the desired properties.

**RL Connection:**

The hierarchy **semiring $\to$ algebra $\to$ $\sigma$-algebra** has a precise operational interpretation in RL:

**1. Semiring ‚Üî One-Step Transitions**
- A semiring $\mathcal{R}_n$ of rectangles represents **elementary state regions** reachable in a single time step
- The transition kernel $P(\cdot | s,a)$ assigns probabilities to these elementary regions
- Closure under intersection: if $R_1, R_2$ are reachable, so is $R_1 \cap R_2$ (refined observation)
- Difference decomposition: if $R_2 \supseteq R_1$, then $R_2 \setminus R_1$ represents "new states accessible via $R_2$ but not $R_1$"

**2. Algebra ‚Üî Finite-Horizon Queries**
- An algebra $\mathcal{A}$ represents sets observable through **finite Boolean combinations** of elementary checks
- Example: "Is the state in region $A$ or its complement $A^c$?" (binary decision)
- Finite-horizon value functions $V^{(N)}(s) = \mathbb{E}[\sum_{t=0}^{N-1} r_t | s_0 = s]$ depend on finite unions of reachable sets
- **Not yet closed under countable unions**: cannot represent "reachable in finite but unbounded time"

**3. $\sigma$-Algebra ‚Üî Infinite-Horizon Observability**
- A $\sigma$-algebra $\mathcal{F}$ represents **all limit events**: sets definable through countable operations
- Example: "Is the state eventually in $A$?" requires $\bigcup_{t=1}^{\infty} P^t(A | s,a)$ (countable union)
- Infinite-horizon value $V(s) = \mathbb{E}[\sum_{t=0}^{\infty} \gamma^t r_t | s_0 = s]$ is a countable sum‚Äîrequires $\sigma$-algebra for measurability
- The **Bellman operator** $TV(s) = r(s,a) + \gamma \int_{S'} V(s') P(ds' | s,a)$ is well-defined only if $V$ is $\mathcal{F}$-measurable.

**Carath√©odory Extension and Value Iteration: A Structural Analogy**

Both constructions extend a simple, finite object to a limiting, infinite object via a process that requires identifying which candidates satisfy a closure/completeness property:

**Carath√©odory Extension:**
1. Start with pre-measure $\mu_0$ on algebra $\mathcal{A}$ (finite operations)
2. Extend to outer measure $\mu^*$ on all subsets (limiting process via infimum)
3. Identify which sets are $\mu^*$-measurable (additivity criterion ensures closure)
4. Restrict to $\sigma$-algebra $\mathcal{M}$ to obtain measure $\mu$ (complete object)

**Value Iteration:**
1. Start with finite-horizon value $V^{(N)}$ on state space (finite time)
2. Define candidate limit $V(s) = \lim_{N \to \infty} V^{(N)}(s)$ (limiting process)
3. Identify when this limit exists and is unique (contraction mapping ensures convergence)
4. Verify $V$ is measurable (closure of measurable functions under pointwise limits)

In both cases, the **measurability/closure condition** ensures that the limiting object is well-defined and computable via the expected value operator.

**Open Questions:**

1. **Non-$\sigma$-Finite Measures:** The Carath√©odory construction works for any outer measure, but uniqueness of extension requires $\sigma$-finiteness. For MDPs with unbounded state spaces, is $\sigma$-finiteness always guaranteed? What happens if it fails?

2. **Non-Borel State Spaces:** We have assumed $\mathcal{S}$ is a Borel space (a measurable space isomorphic to a Borel subset of a Polish space). What if $\mathcal{S}$ is not a separable metric space? (E.g., $\mathcal{S} = \mathbb{R}^\mathbb{N}$ with product $\sigma$-algebra.) Can we still construct transition kernels via Carath√©odory? This motivates the theory of **analytic sets** and **universally measurable policies** (see Bertsekas-Shreve Vol. 1, Ch. 7).

3. **Carath√©odory for Continuous-Time:** In continuous-time MDPs (Week 40), states evolve according to stochastic differential equations. How does Carath√©odory's construction generalize to measures on path spaces (spaces of continuous functions $[0,T] \to \mathcal{S}$)? This leads to the **Wiener measure** and **It√¥'s theory**.

---

**Looking Ahead:**

- **Week 2:** We will use Lebesgue measure to define $L^p$ spaces, the natural home for value functions.
- **Week 3:** Fubini's theorem, proven using Carath√©odory's construction for product measures, will justify computing expectations via iterated integrals‚Äîessential for analyzing Markov chains.
- **Week 6:** Conditional expectation, defined as a projection in $L^2$, relies on the completeness of Lebesgue measure (a consequence of Carath√©odory's construction).
- **Week 12:** Transition kernels on general state spaces (Meyn-Tweedie) are built via Carath√©odory-type extensions.

The construction we have studied today is the foundation upon which the entire edifice of stochastic control and reinforcement learning is erected. Mastering it now will yield compounding returns throughout the 48-week journey.

---

**End of Day 4**

Tomorrow (Day 5 ‚Äì Friday): We synthesize the week's material, implement a discrete $\sigma$-algebra generator in Python, and reflect on the connection between measurability and observability in reinforcement learning.
